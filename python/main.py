#!/usr/bin/env python
# -*- coding: utf-8 -*-
import pandas as pd
import numpy as np
import json
import re
import cookpad 
import twi 


df_calorie = pd.read_csv('python/calorie.csv')

# food_number     int64
# food_name      object
# cal             int64

# æ—¥æœ¬æ¨™æº–é£Ÿå“æˆåˆ†è¡¨ã‚’ã‚‚ã¨ã«ã‚«ãƒ­ãƒªãƒ¼ã‚’è¨ˆç®—ã™ã‚‹
def calc_calorie(ingredients, quantites):
    cal = 0
    for ingredient, quantity in zip(ingredients.values(), quantites.values()):
      print(ingredient, quantity)
      #DBã‚’æ¤œç´¢
      searched = df_calorie[df_calorie['food_name'].str.contains(ingredient)]
      #DBã«è©²å½“ã™ã‚‹é£ŸæãŒã‚ã£ãŸå ´åˆ
      if(len(searched.index) > 0):
        print(quantity)
        quantity_int = quantity_convert(quantity)
        print(quantity_int)
        cal += searched. iat[0, 2].item() * quantity_int / 100
    return int(cal)

#ã€€è¡¨è¨˜æºã‚Œã®ã‚ã‚‹åˆ†é‡è¡¨è¨˜ã‚’ï¼Œã‚°ãƒ©ãƒ ã«å¤‰æ›ã™ã‚‹
def quantity_convert(quantity):
    # ä½•g
    if re.match('\d* g', quantity):
      return int(re.sub(r"\D", "", quantity))

    #TODO 1/2ã‚’12ã¨ã—ã¦è¨ˆç®—ã—ã¦ã—ã¾ã†
    # å¤§ã•ã˜
    if 'å¤§ã•ã˜' in quantity:
      return int(re.sub(r"\D", "", quantity))*15
    # å°ã•ã˜
    if 'å°ã•ã˜' in quantity:
      return int(re.sub(r"\D", "", quantity))*5

    match quantity:
      case _:
        return 5




def main(food):
# ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã—ã¦jsonã«æ›¸ãè¾¼ã‚€
    with open('json/recipe.json', 'w') as f:
      f.write('[')
      # food = 'è±šè‚‰'      #æ¤œç´¢ã—ãŸã„é£Ÿæ
      # è¾æ›¸ã‚’è¦ç´ ã«æŒã¤ãƒªã‚¹ãƒˆãŒè¿”ã‚‹
      # titles, links, images, ingredients_list, quantities_list = cookpad.crawler(food)
      
      #ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿
      titles = ['ç°¡å˜â™ªã‚‚ã‚„ã—ã¨è±šãƒãƒ©ã®ãƒãƒ¨ã½ã‚“ç‚’ã‚ï¼', 'ç™½èœã¨è±šã®ç…®ç‰©', 'ã‚°ãƒ©ãƒ 100å††ã®è±šè‚‰ã‚’æœ€é«˜ã®ãƒˆãƒ³ãƒ†ã‚­ã«ï¼', 'è±šè‚‰ã¨ãªã™ãƒ»ã¿ã‚‡ã†ãŒã®é…¢é†¤æ²¹ç‚’ã‚', 'è±šè‚‰ã®è’²ç„¼ãä¸¼', 'ãƒ¢ãƒ­ãƒ˜ã‚¤ãƒ¤ã¨è±šè‚‰ã®ã‚¹ã‚¿ãƒŸãƒŠç‚’ã‚', 'ã‚­ã‚¦ã‚¤ã§ã”é¦³èµ°ï¼æŸ”ã‚‰ã‹è±šãƒ”ãƒƒãƒ„ã‚¡ã‚¤ã‚ªãƒ¼ãƒ©', 'ç°¡å˜ã«ã§ãã¡ã‚ƒã†ï¼è±šè‚‰ã®ãƒ”ã‚¿ã‚«', 'è±šãƒãƒ©ã¨ã˜ã‚ƒãŒã„ã‚‚ã®ã‚ã¾ã‹ã‚‰ã«', 'æ¢…è±š', 'è±šã®ã—ã‚‡ã†ãŒç„¼ã']
      links = ['https://cookpad.com/recipe/6296894', 'https://cookpad.com/recipe/7290841', 'https://cookpad.com/recipe/7290797', 'https://cookpad.com/recipe/7290618', 'https://cookpad.com/recipe/7290653', 'https://cookpad.com/recipe/7290397', 'https://cookpad.com/recipe/7279592', 'https://cookpad.com/recipe/7290402', 'https://cookpad.com/recipe/7290250', 'https://cookpad.com/recipe/7290245', 'https://cookpad.com/dining/recipes/2763067']
      images = ['https://img.cpcdn.com/recipes/6296894/894x1461s/1ae484c5209e922e705523a0c1b1cf80?u=23975908&p=1592096864', 'https://img.cpcdn.com/recipes/7290841/894x1461s/e6ee02ccd2cfa4e68400c1f7e19b3241?u=45939868&p=1661083416', 'https://img.cpcdn.com/recipes/7290797/894x1461s/377c51776e72345ec34bbc387923899b?u=5466776&p=1661081383', 'https://img.cpcdn.com/recipes/7290618/894x1461s/af552d2b4cda9fb9fef136babadd0e0a?u=47380115&p=1661080066', 'https://img.cpcdn.com/recipes/7290653/894x1461s/c61d95996b2a73967854080612ae55c7?u=10162422&p=1661074791', 'https://img.cpcdn.com/recipes/7290397/894x1461s/69051384bcc07d65d531a575bc9e16f2?u=7852572&p=1661065260', 'https://img.cpcdn.com/recipes/7279592/894x1461s/7dd70acc6646a0b7216a0333320321fa?u=44510773&p=1660093231', 'https://img.cpcdn.com/recipes/7290402/894x1461s/a3372cf2b5750179c787ba554f5f7014?u=2277874&p=1661063561', 'https://img.cpcdn.com/recipes/7290250/894x1461s/458dbc44fd72c08044a74a0829642385?u=1708736&p=1661055142', 'https://assets.cpcdn.com/assets/blank_logo_recipe_large.png?1b12035e517eeddc39631fb65f35fcad69e4b14bf9275634c54589903d659823', '']
      ingredients_list = [{0: 'ã‚‚ã‚„ã—', 1: 'è±šãƒãƒ©è–„åˆ‡ã‚Šï¼ˆåˆ‡ã‚Šè½ã¨ã—ï¼‰', 2: 'å‘³ä»˜ã‘å¡©èƒ¡æ¤’', 3: 'ãƒãƒ¨ãƒãƒ¼ã‚º', 4: 'å‘³ã½ã‚“', 5: 'å°ãƒã‚®', 6: 'ãƒŸãƒ‹ãƒˆãƒãƒˆ'}, {0: 'ç™½èœ', 1: 'æ°´', 2: 'è±šè‚‰', 3: 'è–„å£ã—ã‚‡ã†ã‚†', 4: 'ç ‚ç³–', 5: 'ã¿ã‚Šã‚“'}, {0: 'è±šè‚‰ãƒ­ãƒ¼ã‚¹', 1: 'å¡©èƒ¡æ¤’', 2: 'å°éº¦ç²‰', 3: 'ãƒ‹ãƒ³ãƒ‹ã‚¯', 4: 'â˜…ã‚¦ã‚¹ã‚¿ãƒ¼ã‚½ãƒ¼ã‚¹', 5: 'â˜…é†¤æ²¹', 6: 'â˜…ã¿ã‚Šã‚“', 7: 'â˜…ç ‚ç³–', 8: 'â˜…å‘³ã®ç´ (ã‚ã‚Œã°)', 9: 'ãƒã‚¿ãƒ¼'}, {0: 'è±šè–„åˆ‡ã‚Šè‚‰', 1: 'ãªã™', 2: 'ã¿ã‚‡ã†ãŒ', 3: 'å¡©ã‚³ã‚·ãƒ§ã‚¦', 4: 'ã‚µãƒ©ãƒ€æ²¹', 5: 'é…¢', 6: 'ã—ã‚‡ã†ã‚†'}, {0: 'è±šè‚‰', 1: 'ã”é£¯', 2: 'ã‚«ã‚¤ãƒ¯ãƒ¬', 3: 'å±±è‘µ', 4: 'ç ‚ç³–', 5: 'é…’', 6: 'ã¿ã‚Šã‚“', 7: 'æ¿ƒå£é†¤æ²¹'}, {0: 'ãƒ¢ãƒ­ãƒ˜ã‚¤ãƒ¤', 1: 'è±šãƒ­ãƒ¼ã‚¹è–„åˆ‡ã‚Šè‚‰', 2: 'ç‰ã­ãï¼ˆå°ï¼‰', 3: 'ã«ã‚“ã«ã', 4: 'Aã—ã‚‡ã†ã‚†', 5: 'Aã¿ã‚Šã‚“', 6: 'Aé…’', 7: 'ã‚µãƒ©ãƒ€æ²¹'}, {0: 'è±šãƒ­ãƒ¼ã‚¹(ãƒˆãƒ³ã‚«ãƒ„ç”¨)', 1: 'ã‚¼ã‚¹ãƒ—ãƒªã‚­ã‚¦ã‚¤', 2: 'å¡©', 3: 'ç™½ãƒ¯ã‚¤ãƒ³', 4: 'EXãƒãƒ¼ã‚¸ãƒ³ã‚ªãƒªãƒ¼ãƒ–ã‚ªã‚¤ãƒ«', 5: 'ãƒãƒ¼ãƒ–ã‚½ãƒ«ãƒˆ', 6: 'ã‚³ã‚·ãƒ§ã‚¦', 7: 'ãƒ”ã‚¶ç”¨ãƒãƒ¼ã‚º', 8: 'ãƒã‚¸ãƒ«ã®è‘‰ã€ãƒŸãƒ‹ãƒˆãƒãƒˆ'}, {0: 'è±šè‚‰', 1: 'å¡©', 2: 'å°éº¦ç²‰', 3: 'ãƒ‘ãƒ«ãƒ¡ã‚¶ãƒ³ãƒãƒ¼ã‚º', 4: 'åµ', 5: 'ã‚ªãƒªãƒ¼ãƒ–ã‚ªã‚¤ãƒ«'}, {0: 'ã˜ã‚ƒãŒã„ã‚‚', 1: 'è±šãƒãƒ©è‚‰', 2: 'ã‚¦ã‚£ãƒ³ãƒŠãƒ¼', 3: 'åˆ»ã¿ã‚ªã‚¯ãƒ©', 4: 'ã”ã¼ã†ã¦ã‚“'}, {0: 'è±šãƒãƒ©ãƒ–ãƒ­ãƒƒã‚¯', 1: 'å¡©ã‚³ã‚·ãƒ§ã‚¦', 2: 'ã«ã‚“ã«ã', 3: 'ã—ã‚‡ã†ãŒ', 4: 'é•·ãƒã‚®', 5: 'æ°´', 6: 'é…’', 7: 'ã—ã‚‡ã†ã‚†', 8: 'ç ‚ç³–', 9: 'æ¢…', 10: 'ã‚†ã§åµ'}, {}]
      quantities_list = [{0: 'ç´„100g', 1: '5æš', 2: 'é©é‡', 3: 'å°ã•ã˜1/2ã€œ', 4: 'å°ã•ã˜1/2ã€œ', 5: 'ã‚ã‚Œã°ã€ãŠå¥½ã¿ã§ã€‚', 6: 'ã‚ã‚Œã°ã€ãŠå¥½ã¿ã§â™ª'}, {0: '4/1', 1: '500cc', 2: 'é©é‡', 3: 'å¤§ã•ã˜3', 4: 'å¤§ã•ã˜3', 5: 'å¤§ã•ã˜1'}, {0: 'ï¼‘æšåˆã¯ï¼’æš', 1: 'ä¸‹å‘³ç¨‹åº¦', 2: 'è±šè‚‰ã«ã¾ã¶ã™ç¨‹åº¦', 3: 'ï¼‘ç‰‡', 4: 'å¤§ã•ã˜ï¼’', 5: 'å¤§ã•ã˜ï¼‘', 6: 'å¤§ã•ã˜ï¼‘', 7: 'ç ‚ç³–', 8: 'ï¼“æŒ¯ã‚Š', 9: 'ï¼•g'}, {0: '200g', 1: '3å€‹', 2: '1ãƒ‘ãƒƒã‚¯', 3: 'å°‘ã€…', 4: 'é©é‡', 5: 'å¤§ã•ã˜1.5', 6: 'å¤§ã•ã˜1.5'}, {0: '400gç¨‹', 1: 'é©é‡', 2: 'ï¼‘ãƒ‘ãƒƒã‚¯', 3: 'ãŠå¥½ã¿', 4: 'å¤§ã•ã˜8', 5: 'å¤§ã•ã˜8', 6: 'å¤§ã•ã˜8', 7: 'å¤§ã•ã˜8'}, {0: '1 è¢‹', 1: '200g', 2: '1/2å€‹', 3: '1æ¬ ã‘', 4: 'å¤§ã•ã˜1', 5: 'å¤§ã•ã˜1', 6: 'å¤§ã•ã˜1', 7: 'å¤§ã•ã˜1'}, {0: 'ï¼“ï½ï¼”æš(250ï½300g)', 1: 'ï¼‘å€‹', 2: 'å°ã•ã˜1/3', 3: 'å¤§ã•ã˜2', 4: 'å¤§ã•ã˜1', 5: 'å°‘ã€…', 6: 'å°‘ã€…', 7: 'å¥½ããªã ã‘', 8: 'é©é‡'}, {0: '500g', 1: 'é©é‡', 2: 'å¤§ã•ã˜3', 3: 'å°‘ã€…', 4: '3å€‹', 5: 'å°‘ã€…'}, {0: 'ï¼•å€‹ãã‚‰ã„', 1: 'ï¼‘ãƒ‘ãƒƒã‚¯', 2: '5æœ¬', 3: 'ï¼‘è¢‹', 4: 'ï¼’æš'}, {0: '100g', 1: 'å°‘ã€…', 2: '1å€‹', 3: 'å°‘ã€…', 4: '1/2æœ¬', 5: '200cc', 6: 'å¤§3', 7: 'å¤§3', 8: 'å¤§1', 9: '6å€‹', 10: '2å€‹'}, {}]

      print(titles, links, images, ingredients_list, quantities_list)

      for title, link, image, ingredients, quantities in zip(titles, links, images, ingredients_list, quantities_list):
        #ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—
        cal = calc_calorie(ingredients, quantities)
        #jsonç”¨ã«è¾æ›¸å‹ã«å¤‰å½¢
        d = {'title':title, 'ingredients':ingredients, 'quantities':quantities, 'calorie':cal, 'image':image, 'link':link}
        #jsonã«æ ¼ç´
        json.dump(d, f, indent = 4, ensure_ascii=False)
        
        if titles[-1] != title:
          f.write(',')
      f.write(']')
      f.close()

#twitter
    with open('json/twitter.json', 'w') as f:
      f.write('[')
      texts, links, pictures = twi.printTweetBySearch(food)
      # texts = ['ç±³ç²‰ã®ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­\n#ç™½å´èŒ¶ä¼š ã•ã‚“ã®ãƒ¬ã‚·ãƒ”ã‚ˆã‚Šhttps://t.co/b92RGniIeh\nç±³ç²‰ã€ç”˜é…’ã€BPç­‰ã‚’ä½¿ã„ã€æ¢¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒˆã‚‚æ·»ãˆã¦\nææ–™ã®æ¿ƒç¸®ã‚¿ã‚¤ãƒ—ç”˜é…’ã¯ç³€ã¨é¤…ã§ä½œã£ãŸç”˜é…’ã‚’ãƒ–ãƒ¬ãƒ³ãƒ€ã«ã‹ã‘ç”¨æ„\n\nå°éº¦ã€åµã€ä¹³ç„¡ã—ã§ä¸å®‰ã ã£ãŸã‘ã©ã€ãã¡ã‚“ã¨è†¨ã‚‰ã‚“ã§ãã‚Œã¦å®‰å¿ƒ\n\n#ãƒ©ãƒ³ãƒ #ãŠã†ã¡ã”ã¯ã‚“ #æ‰‹ä½œã‚ŠãŠã‚„ã¤ https://t.co/HIy3qLDpI0', 'ã€ãµã£ãã‚‰ã¨ã—ãŸåµãã¼ã‚ã€‘\n\nã‚³ãƒ³ãƒ“ãƒ‹å¼å½“ãªã©ã®ãµã£ãã‚‰ç”˜ã„åµãã¼ã‚ã‚’å†ç¾ï¼\nã‹ãæ··ãœå™¨ã‚’ä½¿ã†äº‹ã§å¤±æ•—ã—ãªã„ãƒ¬ã‚·ãƒ”ã«ãªã£ã¦ã„ã¾ã™â™ª\n\nhttps://t.co/9GiCOtq0HV\n\n#æ–™ç†ç”·å­\n#æ–™ç†å¥½ããªäººã¨ç¹‹ãŒã‚ŠãŸã„\n#ã‚¯ãƒƒã‚¯ãƒ‘ãƒƒãƒ‰\n#ã‚¯ãƒƒã‚¯ãƒ‘ãƒƒãƒ‰ã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼2022\n#cookpad_news https://t.co/ictCEiMIZU', 'ã“ã‚“ã«ã¡ã¯ğŸŒ\næ¯æœˆ19æ—¥ã¯ç†Ÿæˆã®æ—¥ï¼ğŸ˜ŒğŸ’›\nã‚°ãƒ©ãƒ³ãƒ‰ã‚¢ãƒ«ãƒˆãƒã‚¤ã‚¨ãƒ«ãƒ³ã¨åµãƒãƒ¨ã®åŒ…ã¿ç„¼ãã®ã”ç´¹ä»‹ã§ã™ï¼ğŸ˜‰é¤ƒå­ã®çš®ãŒä½™ã£ãŸã¨ãã«å¬‰ã—ã„ã‚¢ãƒ¬ãƒ³ã‚¸ãƒ¬ã‚·ãƒ”ã§ã™ğŸ¥Ÿâœ¨ãŠã¤ã¾ã¿ã«ã´ã£ãŸã‚Šã§ã™ã‚ˆï¼ğŸ»ä»Šæ—¥ã®æ™©é…Œã®ãŠä¾›ã«ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼ŸğŸ¥°æº¢ã‚Œã‚‹è‚‰æ±ãŒãŸã¾ã‚‰ãªã„ã§ã™ï½ï¼ğŸ¥º https://t.co/gecCIcNSzR', 'ã¿ã¦ï¼ã“ã®ç¾å‘³ã—ãã†ãªãƒãƒ£ãƒ—ãƒã‚§ã¨ãµã‚ãµã‚ã®åµã‚¹ãƒ¼ãƒ—ğŸ¤¤â¤ï¸ï¼\u3000ãŠåº—ã®ã‚¹ãƒ¼ãƒ—ã¿ãŸã„ã‚„ã‚ï¼Ÿ\u3000ã§ã‚‚ãªã‚“ã¨ãƒ¯ã‚¤ä½œã‚„âœŒï¸âœ¨ç¬‘\u3000æ˜¨æ—¥ã®æ™©ã”ã¯ã‚“ã¯ã€é£Ÿäº‹å‡¦ã•ãã‚‰ã•ã‚“ï¼ˆ@mo224co ï¼‰ã®ãƒ¬ã‚·ãƒ”æœ¬ã§ä½œã£ã¦ã¿ãŸã®ğŸ˜»âœ¨\u3000ã»ã‚“ã®ã¡ã‚‡ã£ã¨ã®ã‚³ãƒ„ã§ã“ã‚“ãªã«ä¸Šæ‰‹ãªã‚Œã‚‹ãªã‚“ã¦ãƒãƒ¼ãƒ³æ„Ÿæ¿€ğŸ˜­âœ¨ã‚ã£ã¡ã‚ƒã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ğŸ˜‡â¤ï¸ https://t.co/8XIJKgQNKR', 'ä»Šæ—¥ã®1å“ã¯â€¦\n\nå¤§è‘‰ãƒ„ãƒŠãŸã¾ã”ã”ã¯ã‚“â™ª\n\nåµã‹ã‘ã”ã¯ã‚“ã®ã‚¢ãƒ¬ãƒ³ã‚¸ãƒ¬ã‚·ãƒ”â™ª\nå¿™ã—ã„æœã«ãŠã™ã™ã‚ğŸ˜‹\n\nï¼œã‚¢ãƒ¡ãƒ–ãƒ­ï¼\nhttps://t.co/buDXY3WGO6\n\nï¼œYouTubeï¼\nhttps://t.co/Q6kCFq2gmP\n\n#æ–™ç†å¥½ãã•ã‚“ã¨ç¹‹ãŒã‚ŠãŸã„ #Twitteræ–™ç†éƒ¨ #ãŠè…¹ãºã‚³ãƒªãƒ³éƒ¨ #ä»Šæ—¥ã®1å“ https://t.co/klNHyN0zRr']
      # links = ['https://t.co/b92RGniIeh', 'https://t.co/9GiCOtq0HV', 'https://t.co/gecCIcNSzR', 'https://t.co/8XIJKgQNKR', 'https://t.co/buDXY3WGO6']
      print(texts)
      print(links)
      print(pictures)
      for text, link, pic in zip(texts, links, pictures):
        d = {'TweetText':text, 'link':link, 'picture':pic}
        json.dump(d, f, indent = 4, ensure_ascii=False)
      f.write(']')
      f.close()


if __name__ == "__main__":
    main('è±š')

